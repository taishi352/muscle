<div class="jumbotron">
	<h1 class="text-center">All Posts</h1>
</div>

<div class="container">

	<div class="row">

		<div class="col-md-10">
			<%= link_to "新規投稿", new_post_path, class: "btn btn-primary col-xs-6 col-xs-offset-3" %>

			<table class="table table-hover table-inverse">
				<thead>
					<tr>
						<th>ユーザー</th>
						<th>タイトル</th>
						<th>ジャンル</th>
						<th></th>
						<th></th>
					</tr>
				</thead>

				<tbody>
					<% @posts.each do |post| %>
						<tr>
							<td>
								<%= attachment_image_tag post.user, :profile_image, :fill, 90, 100, fallback: "no_image.jpg", class: "img-circle" %><br>
								<%= post.user.name %>
							</td>
							<td><%= link_to post.title, post %></td>
							<td><%= post.genre.genre_name %></td>
							<td>
								<% if post.favorited_by?(current_user) %>
									<td>
										<%= link_to post_favorites_path(post), method: :delete do %>
											<span class="glyphicon glyphicon-heart" aria-hidden="true" style="color: red;"></span>
											<%= post.favorites.count %>
										<% end %>
									</td>
								<% else %>
									<td>
										<%= link_to post_favorites_path(post), method: :post do %>
											<span class="glyphicon glyphicon-heart" aria-hidden="true"></span>
											<%= post.favorites.count %>
										<% end %>
									</td>
								<% end %>
							</td>
							<td>
								コメント件数:<%= post.post_comments.count %>
							</td>
						</tr>
					<% end %>
				</tbody>
			</table>
			<%= paginate @all, class: "paginate text-right" %>
		</div>

		<div class="col-md-2">
			<h3>ジャンル検索</h3>

			<% if user_signed_in? %>
  				<% if current_user == @user || current_user.admin? %>
					<p><%= link_to "ジャンル作成", new_genre_path, class: "btn btn-primary" %></p>
				<% end %>
			<% end %>

			<%= link_to "全て" , posts_path %><br>
			<% @genres.each do |genre| %>
				<%= link_to genre.genre_name ,"/posts?genre_id=#{genre.id}" %><br>
				<% if user_signed_in? %>
  					<% if current_user == @user || current_user.admin? %>
						<%= link_to "(編集)", edit_genre_path(genre.id) %>
						<%= link_to "(削除)", genre_path(genre.id), method: :delete, data: {confirm: "本当に削除してもよろしいですか？"} %><br>
					<% end %>
				<% end %>
			<% end %>
		</div>
	</div>
</div>